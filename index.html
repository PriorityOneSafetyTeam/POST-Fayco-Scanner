<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>POST Fayco Live Scanner</title>

<style>
    body {
        margin: 0;
        background: #000;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        font-family: "Segoe UI", sans-serif;
        color: #e6e6e6;
    }

    /* Responsive container */
    .scanner-box {
        width: 90%;
        max-width: 380px;
        background: #0a0a0a;
        border-radius: 18px;
        box-shadow:
            0 0 25px rgba(0, 0, 0, 0.9),
            inset 0 0 18px rgba(255, 140, 0, 0.08);
        padding: 22px;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        box-sizing: border-box;
    }

    @media (max-width: 480px) {
        .scanner-box {
            padding: 18px;
            max-width: 95%;
        }
    }

    .title {
        font-size: 18px;
        text-align: center;
        margin-bottom: 4px;
        color: #f0f0f0;
    }

    .subtitle {
        font-size: 12px;
        text-align: center;
        color: #b3b3b3;
        margin-bottom: 10px;
    }

    .play-btn {
        width: 70px;
        height: 70px;
        border-radius: 50%;
        border: none;
        background: #1a1a1a;
        color: #f0f0f0;
        font-size: 28px;
        cursor: pointer;
        margin: 0 auto;
        display: flex;
        justify-content: center;
        align-items: center;
        box-shadow:
            0 0 12px rgba(255, 140, 0, 0.25),
            inset 0 0 10px rgba(255, 140, 0, 0.15);
        transition: 0.15s ease;
    }

    .play-btn:hover {
        transform: scale(1.05);
        box-shadow:
            0 0 16px rgba(255, 140, 0, 0.35),
            inset 0 0 12px rgba(255, 140, 0, 0.2);
    }

    .volume-row {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-top: 10px;
    }

    .volume-icon {
        font-size: 20px;
        color: #d87a1a;
    }

    input[type="range"] {
        width: 100%;
        -webkit-appearance: none;
        height: 5px;
        border-radius: 999px;
        background: linear-gradient(
            to right,
            #d87a1a 0%,
            #d87a1a var(--value, 100%),
            #333 var(--value, 100%),
            #333 100%
        );
        outline: none;
    }

    input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 14px;
        height: 14px;
        border-radius: 50%;
        background: #d87a1a;
        cursor: pointer;
        box-shadow: 0 0 6px rgba(216, 122, 26, 0.6);
    }

    .led {
        width: 16px;
        height: 16px;
        border-radius: 50%;
        margin: 10px auto 0 auto;
        background: red;
        box-shadow: 0 0 8px rgba(255,0,0,0.7);
        transition: background 0.2s ease, box-shadow 0.2s ease;
    }

    .led.green-ring {
        background: radial-gradient(circle, #555 40%, #00ff00 45%);
        box-shadow: 0 0 8px rgba(0,255,0,0.4);
    }

    .led.green-pulse {
        background: #00ff00;
        animation: pulseGreen 0.8s infinite;
        box-shadow: 0 0 12px rgba(0,255,0,0.8);
    }

    @keyframes pulseGreen {
        0% { box-shadow: 0 0 6px rgba(0,255,0,0.4); }
        50% { box-shadow: 0 0 14px rgba(0,255,0,1); }
        100% { box-shadow: 0 0 6px rgba(0,255,0,0.4); }
    }

    .led.yellow-flash {
        background: yellow;
        animation: flashYellow 0.8s infinite;
        box-shadow: 0 0 10px rgba(255,255,0,0.8);
    }

    @keyframes flashYellow {
        0% { opacity: 1; }
        50% { opacity: 0.3; }
        100% { opacity: 1; }
    }

    .led.red-flash {
        background: red;
        animation: flashRed 0.8s infinite;
        box-shadow: 0 0 12px rgba(255,0,0,1);
    }

    @keyframes flashRed {
        0% { opacity: 1; }
        50% { opacity: 0.3; }
        100% { opacity: 1; }
    }

    @keyframes flashRedText {
        0% { opacity: 1; }
        50% { opacity: 0.3; }
        100% { opacity: 1; }
    }

    .status {
        text-align: center;
        font-size: 12px;
        margin-top: 8px;
    }
</style>
</head>

<body>

<div class="scanner-box">
    <div>
        <div class="title">Fayette County Fire/EMS Paging</div>
        <div class="subtitle">POST Feed â€¢ Live</div>
    </div>

    <button id="playPause" class="play-btn">â–¶</button>

    <div id="led" class="led"></div>

    <div class="volume-row">
        <div class="volume-icon">ðŸ”Š</div>
        <input id="volumeSlider" type="range" min="0" max="1" step="0.01" value="1">
    </div>

    <div id="status" class="status">Safety Com's Offline</div>
</div>

<audio id="scannerAudio" preload="none" crossorigin="anonymous"></audio>

<script>
const STREAM_URL = "https://listen.broadcastify.com/tc2gdnrwpqbs384.mp3?nc=54264&xan=xtf9912b41c";

const audio = document.getElementById("scannerAudio");
const playPauseBtn = document.getElementById("playPause");
const statusEl = document.getElementById("status");
const slider = document.getElementById("volumeSlider");
const led = document.getElementById("led");

let isPlaying = false;
let reconnectTimer = null;
let audioContext, analyser, source;

function updateSliderFill() {
    const percent = slider.value * 100 + "%";
    slider.style.setProperty("--value", percent);
}
slider.addEventListener("input", updateSliderFill);
window.addEventListener("load", updateSliderFill);

function setLED(state) {
    led.className = "led " + state;
}

function setupAnalyzer() {
    audioContext = new (window.AudioContext || window.webkitAudioContext)();
    analyser = audioContext.createAnalyser();
    source = audioContext.createMediaElementSource(audio);
    source.connect(analyser);
    analyser.connect(audioContext.destination);
    analyser.fftSize = 256;
}

function monitorAudio() {
    const data = new Uint8Array(analyser.frequencyBinCount);

    function check() {
        analyser.getByteFrequencyData(data);
        let volume = data.reduce((a, b) => a + b) / data.length;

        if (!isPlaying) return;

        if (volume > 20) {
            setLED("green-pulse");
        } else {
            setLED("green-ring");
        }

        requestAnimationFrame(check);
    }
    check();
}

async function startStream() {
    try {
        setLED("yellow-flash");
        statusEl.textContent = "Safety Com's Offline";
        statusEl.style.color = "red";
        statusEl.style.animation = "none";

        audio.src = STREAM_URL;
        await audio.play();

        if (!audioContext) setupAnalyzer();
        monitorAudio();

        isPlaying = true;
        playPauseBtn.textContent = "â¸";

        statusEl.textContent = "Safety Com's Activated";
        statusEl.style.color = "#00ff00";
        statusEl.style.animation = "none";

        setLED("green-ring");

    } catch (err) {
        statusEl.textContent = "Safety Com's Signal Failure";
        statusEl.style.color = "red";
        statusEl.style.animation = "flashRedText 0.8s infinite";
        setLED("red-flash");
    }
}

function stopStream() {
    audio.pause();
    isPlaying = false;
    playPauseBtn.textContent = "â–¶";

    statusEl.textContent = "Safety Com's on Standby";
    statusEl.style.color = "#e6e6e6";
    statusEl.style.animation = "none";

    setLED("red");
}

playPauseBtn.addEventListener("click", () => {
    if (isPlaying) stopStream();
    else startStream();
});

slider.addEventListener("input", () => {
    audio.volume = slider.value;
});

audio.addEventListener("error", () => {
    statusEl.textContent = "Safety Com's Reconnecting";
    statusEl.style.color = "yellow";
    statusEl.style.animation = "none";

    setLED("yellow-flash");

    if (reconnectTimer) clearTimeout(reconnectTimer);
    reconnectTimer = setTimeout(() => {
        if (isPlaying) startStream();
    }, 4000);
});

setLED("red");
statusEl.style.color = "red";
</script>

</body>
</html>


